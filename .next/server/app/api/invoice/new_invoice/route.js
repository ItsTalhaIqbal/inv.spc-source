"use strict";(()=>{var e={};e.id=2539,e.ids=[2539],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},66725:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>v,originalPathname:()=>g,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>p});var a={};i.r(a),i.d(a,{DELETE:()=>DELETE,GET:()=>GET,OPTIONS:()=>OPTIONS,POST:()=>POST,PUT:()=>PUT}),i(78976);var s=i(10884),n=i(16132),o=i(8590),r=i(93288),l=i(95798);async function OPTIONS(e){return l.Z.json({},{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}async function GET(e){try{await (0,o.v)();let{searchParams:t}=new URL(e.url),i=t.get("id");if(i){let e=await r.Z.findOne({_id:i}).select("-password");if(!e)return l.Z.json({error:"Invoice not found"},{status:404});let t={_id:e._id.toString(),invoiceNumber:e.invoiceNumber,sender:e.sender,receiver:e.receiver,details:{invoiceLogo:e.details.invoiceLogo,invoiceNumber:e.details.invoiceNumber,invoiceDate:e.details.invoiceDate,dueDate:e.details.dueDate,items:e.details.items,currency:e.details.currency,language:e.details.language,taxDetails:e.details.taxDetails,discountDetails:e.details.discountDetails,shippingDetails:e.details.shippingDetails,paymentInformation:e.details.paymentInformation,additionalNotes:e.details.additionalNotes,paymentTerms:e.details.paymentTerms,signature:e.details.signature,subTotal:e.details.subTotal,totalAmount:e.details.totalAmount,totalAmountInWords:e.details.totalAmountInWords,pdfTemplate:e.details.pdfTemplate,isInvoice:e.details.isInvoice},createdAt:e.createdAt};return l.Z.json(t,{status:200,headers:{"Access-Control-Allow-Origin":"*"}})}{let e=await r.Z.find().select("-password"),t=e.map(e=>({_id:e._id.toString(),invoiceNumber:e.invoiceNumber,sender:e.sender,receiver:e.receiver,details:{invoiceLogo:e.details.invoiceLogo,invoiceNumber:e.details.invoiceNumber,invoiceDate:e.details.invoiceDate,dueDate:e.details.dueDate,items:e.details.items,currency:e.details.currency,language:e.details.language,taxDetails:e.details.taxDetails,discountDetails:e.details.discountDetails,shippingDetails:e.details.shippingDetails,paymentInformation:e.details.paymentInformation,additionalNotes:e.details.additionalNotes,paymentTerms:e.details.paymentTerms,signature:e.details.signature,subTotal:e.details.subTotal,totalAmount:e.details.totalAmount,totalAmountInWords:e.details.totalAmountInWords,pdfTemplate:e.details.pdfTemplate,isInvoice:e.details.isInvoice},createdAt:e.createdAt}));return l.Z.json(t,{status:200,headers:{"Access-Control-Allow-Origin":"*"}})}}catch(e){return l.Z.json({error:"Internal server error",details:e.message},{status:500})}}async function POST(e){try{await (0,o.v)();let t=await e.json();console.log("Request body:",t);let i=await r.Z.findOne({invoiceNumber:t.invoiceNumber});if(i)return l.Z.json({error:"Invoice number already exists",details:`Invoice number ${t.invoiceNumber} is already in use`},{status:409});let a=await r.Z.create({invoiceNumber:t.invoiceNumber,sender:t.sender,receiver:t.receiver,details:{invoiceLogo:t.details.invoiceLogo,invoiceNumber:t.details.invoiceNumber,invoiceDate:t.details.invoiceDate,dueDate:t.details.dueDate,items:t.details.items,currency:t.details.currency,language:t.details.language,taxDetails:t.details.taxDetails,discountDetails:t.details.discountDetails,shippingDetails:t.details.shippingDetails,paymentInformation:t.details.paymentInformation,additionalNotes:t.details.additionalNotes,paymentTerms:t.details.paymentTerms,signature:t.details.signature,subTotal:t.details.subTotal,totalAmount:t.details.totalAmount,totalAmountInWords:t.details.totalAmountInWords,pdfTemplate:t.details.pdfTemplate,isInvoice:t.details.isInvoice},createdAt:t.createdAt||new Date}),s={invoiceNumber:a.invoiceNumber,sender:a.sender,receiver:a.receiver,details:{invoiceLogo:a.details.invoiceLogo,invoiceNumber:a.details.invoiceNumber,invoiceDate:a.details.invoiceDate,dueDate:a.details.dueDate,items:a.details.items,currency:a.details.currency,language:a.details.language,taxDetails:a.details.taxDetails,discountDetails:a.details.discountDetails,shippingDetails:a.details.shippingDetails,paymentInformation:a.details.paymentInformation,additionalNotes:a.details.additionalNotes,paymentTerms:a.details.paymentTerms,signature:a.details.signature,subTotal:a.details.subTotal,totalAmount:a.details.totalAmount,totalAmountInWords:a.details.totalAmountInWords,pdfTemplate:a.details.pdfTemplate,isInvoice:a.details.isInvoice},createdAt:a.createdAt};return l.Z.json(s,{status:201,headers:{"Access-Control-Allow-Origin":"*"}})}catch(e){return console.error("Error in POST /api/invoice/invoice:",e),l.Z.json({error:"Internal server error",details:e.message,stack:e.stack},{status:500})}}async function PUT(e){try{await (0,o.v)();let t=await e.json(),{invoiceNumber:i,sender:a,receiver:s,details:n,_id:d}=t;if(!d)return l.Z.json({error:"Invoice ID is required"},{status:400});let u={};i&&(u.invoiceNumber=i),a&&(u.sender=a),s&&(u.receiver=s),n&&(u.details={invoiceLogo:n.invoiceLogo,invoiceNumber:n.invoiceNumber,invoiceDate:n.invoiceDate,dueDate:n.dueDate,items:n.items,currency:n.currency,language:n.language,taxDetails:n.taxDetails,discountDetails:n.discountDetails,shippingDetails:n.shippingDetails,paymentInformation:n.paymentInformation,additionalNotes:n.additionalNotes,paymentTerms:n.paymentTerms,signature:n.signature,subTotal:n.subTotal,totalAmount:n.totalAmount,totalAmountInWords:n.totalAmountInWords,pdfTemplate:n.pdfTemplate,isInvoice:n.isInvoice});let c=await r.Z.findByIdAndUpdate(d,u,{new:!0}).select("-password");if(!c)return l.Z.json({error:"Invoice not found"},{status:404});return l.Z.json(!0,{status:200,headers:{"Access-Control-Allow-Origin":"*"}})}catch(e){return l.Z.json({error:"Internal server error",details:e.message},{status:500})}}async function DELETE(e){try{await (0,o.v)();let{searchParams:t}=new URL(e.url),i=t.get("id");if(!i)return l.Z.json({error:"Invoice ID is required"},{status:400});let a=await r.Z.findByIdAndDelete(i);if(!a)return l.Z.json({error:"Invoice not found"},{status:404});return l.Z.json(!0,{status:200,headers:{"Access-Control-Allow-Origin":"*"}})}catch(e){return l.Z.json({error:"Internal server error",details:e.message},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/invoice/new_invoice/route",pathname:"/api/invoice/new_invoice",filename:"route",bundlePath:"app/api/invoice/new_invoice/route"},resolvedPagePath:"C:\\Users\\Hammad\\Desktop\\checks\\Invoice_app\\app\\api\\invoice\\new_invoice\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:m,headerHooks:v,staticGenerationBailout:p}=d,g="/api/invoice/new_invoice/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[4961,4933,8590,3288],()=>__webpack_exec__(66725));module.exports=i})();